---
phase: 01-foundation-identity-family-privacy
plan: "03"
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - app/
  - src/
autonomous: true
user_setup: []
must_haves:
  truths:
    - "User can sign up, log in, stay logged in, and log out"
    - "User can create a family, invite another user, and that user can join"
    - "Non-members cannot access family resources or family/private recipes by direct URL"
    - "Public recipes are viewable by direct link (no browse/listing)"
  artifacts:
    - path: app/(auth)
      provides: "Auth routes"
    - path: app/(family)
      provides: "Family routes"
    - path: app/recipes/[id].tsx
      provides: "Recipe detail route demonstrating visibility enforcement"
  key_links:
    - from: app/(auth)
      to: src/lib/supabase.ts
      via: "Supabase auth client usage"
      pattern: "supabase\\.auth"
---

<objective>
Implement Phase 1 product UX: auth, invite-only families with roles, and minimal recipe detail to validate server-side visibility enforcement end-to-end.

Purpose: Satisfy Phase 1 success criteria with working flows and correct privacy semantics.
Output: Auth screens, family flows (create/invite/accept/roles/leave/remove), and recipe detail route (read-only).
</objective>

<execution_context>
@/Users/elinicholson/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/elinicholson/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-identity-family-privacy/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build auth flows aligned to Phase 1 context</name>
  <files>app/(auth)/*, src/features/auth/*</files>
  <action>
Implement:
- Sign up (email + password; min 8 + number/symbol)
- Log in (stay logged in default on)
- Forgot password: show explicit "email not found" for unknown email (use backend primitive)
- Reset password from link
- Log out (this device only)

Error semantics:
- Treat 401 as "please log in"
- Treat 404 as generic "Not found" (even if it represents unauthorized-by-design)
  </action>
  <verify>npm run typecheck</verify>
  <done>Auth flows work end-to-end against Supabase</done>
</task>

<task type="auto">
  <name>Task 2: Build family create/invite/accept/roles/leave/remove</name>
  <files>app/(family)/*, src/features/family/*</files>
  <action>
Implement:
- Create family and land on family home
- Members list with role badges
- Invite member (members can invite; admins can revoke/resend; 7 day expiry)
- Accept invite from link:
  - If logged out: route to auth, then resume accept
  - If logged in: accept immediately
- Remove member (admin-only)
- Promote/demote (admin-only; multiple admins allowed)
- Leave family (last-admin must transfer admin first)

No public browsing pages in Phase 1.
  </action>
  <verify>npm run typecheck</verify>
  <done>Invite flow works with two accounts; roles + leave/remove constraints enforced</done>
</task>

<task type="auto">
  <name>Task 3: Add minimal recipe detail route for visibility enforcement</name>
  <files>app/recipes/[id].tsx, src/features/recipes/*</files>
  <action>
Create a read-only recipe detail screen that fetches recipe by ID and renders:
- title (or placeholder)
- visibility

Behavior:
- If the query returns no row (RLS), show generic "Not found".
- For public recipes, allow logged-out access via direct URL.
  </action>
  <verify>npm run typecheck</verify>
  <done>Recipe detail demonstrates correct 404/401 semantics and server-side enforcement</done>
</task>

</tasks>

<verification>
- [ ] npm run typecheck passes
- [ ] npx expo export --platform web succeeds
</verification>

<success_criteria>
- All tasks completed
- Phase 1 success criteria are satisfied in the running app
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-identity-family-privacy/01-03-SUMMARY.md`
</output>
